<!doctype html>
<html lang="si">
<head>
  <meta charset="utf-8">
  <title>Student Marks Analysis (Offline)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    h1 { margin-top: 0; }
    textarea { width: 100%; min-height: 200px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: right; }
    th { background: #f0f0f0; }
    td:first-child, th:first-child { text-align: left; }
    .info { margin: 10px 0; }
    .error { color: red; font-size: 13px; }
  </style>
</head>
<body>
  <h1>ශිෂ්‍ය ලකුණු විශ්ලේෂණය</h1>
  <p>පේළියකට ලකුණක් (0–100) ඇතුල් කරන්න. උදා: <br> 75<br>62<br>0<br>88</p>
  
  <textarea id="marks"></textarea><br><br>
  <button id="analyzeBtn">ගණනය කරන්න</button>
  <button onclick="clearAll()">මකන්න</button>
  <div id="errorMsg" class="error"></div>
  <div id="summary" class="info"></div>

  <h2>1 වගුව</h2>
  <table id="table1">
    <thead><tr><th>Range</th><th>Count</th><th>Percentage</th></tr></thead>
    <tbody></tbody>
  </table>

  <h2>2 වගුව</h2>
  <table id="table2">
    <thead><tr><th>Range</th><th>Count</th><th>Percentage</th></tr></thead>
    <tbody></tbody>
  </table>

<script>
const ranges1 = [
  { label: "0", min: 0, max: 0 },
  { label: "1-9", min: 1, max: 9 },
  { label: "20-39", min: 20, max: 39 },
  { label: "40-59", min: 40, max: 59 },
  { label: "60-79", min: 60, max: 79 },
  { label: "80-100", min: 80, max: 100 }
];

const ranges2 = [
  { label: "0-9", min: 0, max: 9 },
  { label: "10-19", min: 10, max: 19 },
  { label: "20-29", min: 20, max: 29 },
  { label: "30-39", min: 30, max: 39 },
  { label: "40-49", min: 40, max: 49 },
  { label: "50-59", min: 50, max: 59 },
  { label: "60-69", min: 60, max: 69 },
  { label: "70-79", min: 70, max: 79 },
  { label: "80-89", min: 80, max: 89 },
  { label: "90-100", min: 90, max: 100 }
];

document.getElementById("analyzeBtn").addEventListener("click", analyze);

function analyze() {
  const raw = document.getElementById("marks").value;
  const parts = raw.split(/[\s,;]+/).map(s => s.trim()).filter(Boolean);
  const values = [];
  const invalid = [];

  for (let p of parts) {
    let v = Number(p);
    if (!Number.isNaN(v) && v >= 0 && v <= 100) {
      values.push(v);
    } else {
      invalid.push(p);
    }
  }

  const errorDiv = document.getElementById("errorMsg");
  if (invalid.length) {
    errorDiv.textContent = "වැරදි අගයන්: " + invalid.join(", ");
  } else {
    errorDiv.textContent = "";
  }

  const total = values.length;
  let sum = values.reduce((a,b)=>a+b,0);
  let avg = total? (sum/total).toFixed(2):0;
  let min = total? Math.min(...values):0;
  let max = total? Math.max(...values):0;

  document.getElementById("summary").textContent = 
    `Total: ${total}, Average: ${avg}, Min: ${min}, Max: ${max}`;

  renderTable("table1", ranges1, values, total);
  renderTable("table2", ranges2, values, total);
}

function renderTable(id, ranges, values, total) {
  const tbody = document.querySelector("#"+id+" tbody");
  tbody.innerHTML = "";
  for (let r of ranges) {
    let count = values.filter(v => v>=r.min && v<=r.max).length;
    let pct = total? ((count/total)*100).toFixed(2):0;
    let tr = document.createElement("tr");
    tr.innerHTML = `<td>${r.label}</td><td>${count}</td><td>${pct}%</td>`;
    tbody.appendChild(tr);
  }
}

function clearAll() {
  document.getElementById("marks").value="";
  document.getElementById("summary").textContent="";
  document.getElementById("errorMsg").textContent="";
  document.querySelector("#table1 tbody").innerHTML="";
  document.querySelector("#table2 tbody").innerHTML="";
}
</script>
</body>
</html>